<div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900" dir="rtl">

  <!-- Navbar -->
  <nav class="sticky top-0 z-50 bg-white/10 backdrop-blur-md border-b border-white/20 shadow-lg">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
          🍳 MyRecipes
        </h1>
        <p class="text-white/70 ml-4"> 👋 ברוך/ה הבא {{ username }} </p>
      </div>
      <button 
        (click)="logout()"
        class="btn btn-error btn-sm gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
        התנתק
      </button>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto p-6">
    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
      
      <!-- Left Side - Form (3 columns) -->
      <div class="lg:col-span-3">
        <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-8 shadow-2xl">
          <h2 class="text-3xl font-bold text-white mb-6">
            {{ isEditingRecipe ? '✏️ ערוך מתכון' : '➕ מתכון חדש' }}
          </h2>
          
          <form (ngSubmit)="isEditingRecipe ? saveEditedRecipe() : addRecipe()" class="space-y-5">
            <!-- Title -->
            <div>
              <label class="block text-white/80 font-semibold mb-2">שם המתכון</label>
              <input 
                type="text" 
                [(ngModel)]="newRecipe.title" 
                name="title"
                placeholder="למשל: עוגת שוקולד..."
                class="input input-bordered w-full bg-white/5 border-white/20 text-white placeholder-white/40 focus:border-purple-500"
              />
            </div>

            <!-- Ingredients -->
            <div>
              <label class="block text-white/80 font-semibold mb-2">🥘 רכיבים</label>
              <textarea 
                [(ngModel)]="newRecipe.ingredients" 
                name="ingredients"
                placeholder="רשום כל רכיב בשורה חדשה..."
                class="textarea textarea-bordered w-full h-24 bg-white/5 border-white/20 text-white placeholder-white/40 focus:border-purple-500"
              ></textarea>
            </div>

            <!-- Instructions -->
            <div>
              <label class="block text-white/80 font-semibold mb-2">📝 הוראות הכנה</label>
              <textarea 
                [(ngModel)]="newRecipe.instructions" 
                name="instructions"
                placeholder="תאר את שלבי ההכנה בפירוט..."
                class="textarea textarea-bordered w-full h-24 bg-white/5 border-white/20 text-white placeholder-white/40 focus:border-purple-500"
              ></textarea>
            </div>

            <!-- Tags & Time -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-white/80 font-semibold mb-2">🏷️ תגיות</label>
                <input 
                  type="text" 
                  [(ngModel)]="newRecipe.tags" 
                  name="tags"
                  placeholder="עוגה, שוקולד..."
                  class="input input-bordered w-full bg-white/5 border-white/20 text-white placeholder-white/40 focus:border-purple-500"
                />
              </div>
              <div>
                <label class="block text-white/80 font-semibold mb-2">⏱️ זמן (דקות)</label>
                <input 
                  type="number" 
                  [(ngModel)]="newRecipe.preparationTime" 
                  name="preparationTime"
                  placeholder="זמן הכנה (דקות)"
                  class="input input-bordered w-full bg-white/5 border-white/20 text-white placeholder-white/40 focus:border-purple-500"
                />
              </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-4">
              <button 
                type="submit" 
                [disabled]="isAddingRecipe"
                class="btn btn-gradient flex-1 gap-2"
              >
                {{ isAddingRecipe ? '⏳ טוען...' : (isEditingRecipe ? '💾 שמור שינויים' : '✅ הוסף מתכון') }}
              </button>
              <button 
                *ngIf="isEditingRecipe"
                type="button" 
                (click)="cancelEdit()"
                class="btn btn-ghost flex-1"
              >
                ❌ ביטול
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Right Side - Image Upload & Search (2 columns) -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Image Upload Card -->
        <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-md border border-purple-400/30 rounded-2xl p-6 shadow-xl">
          <h3 class="text-xl font-bold text-white mb-4">📸 תמונה</h3>
          
          <div class="space-y-4">
            <!-- File Input -->
            <input 
              type="file" 
              accept="image/*"
              (change)="onImageSelected($event)"
              [disabled]="isUploadingImage"
              class="file-input file-input-bordered file-input-primary w-full bg-white/5"
            />

            <!-- Image Preview -->
            <div *ngIf="selectedImage" class="relative group">
              <img 
                [src]="selectedImage" 
                alt="תצוגה מקדימה"
                class="w-full h-48 object-cover rounded-xl shadow-lg transition-transform group-hover:scale-105"
              />
              <button 
                type="button"
                (click)="clearImage()"
                class="absolute top-2 right-2 btn btn-circle btn-sm btn-error"
              >
                ✕
              </button>
              <div *ngIf="isUploadingImage" class="absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center">
                <span class="loading loading-spinner loading-lg text-primary"></span>
              </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="!selectedImage" class="border-2 border-dashed border-white/30 rounded-xl p-8 text-center bg-white/5 hover:bg-white/10 transition">
              <p class="text-white/60">בחר תמונה או גרור לכאן</p>
            </div>
          </div>
        </div>

        <!-- Search Card -->
        <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl p-6 shadow-xl">
          <h3 class="text-xl font-bold text-white mb-4">🔍 חיפוש</h3>
          
          <div class="space-y-3">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              name="searchTerm"
              placeholder="חפש לפי תגיות..."
              (input)="searchByTag()"
              class="input input-bordered w-full bg-white/5 border-white/20 text-white"
            />
            <button 
              (click)="clearSearch()"
              class="btn btn-ghost w-full"
            >
              ✕ נקה חיפוש
            </button>
          </div>
          
          <div class="mt-4 badge badge-primary">
            {{ filteredRecipes.length }} מתכונים
          </div>
        </div>
      </div>
    </div>

    <!-- Recipes Grid -->
    <div class="mt-12">
      <h2 class="text-3xl font-bold text-white mb-6">🍽️ המתכונים שלך</h2>
      
      <div *ngIf="isLoadingRecipes" class="flex justify-center items-center py-12">
        <span class="loading loading-spinner loading-lg text-primary"></span>
      </div>

      <div *ngIf="!isLoadingRecipes && filteredRecipes.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let recipe of filteredRecipes" class="card bg-gradient-to-br from-white/10 to-white/5 border border-white/20 shadow-xl hover:shadow-2xl transition-all hover:-translate-y-1">
          
          <!-- Image -->
          <figure *ngIf="recipe.imageUrl" class="overflow-hidden h-48">
            <img [src]="recipe.imageUrl" alt="תמונת מתכון" class="w-full h-full object-cover transition-transform hover:scale-110"/>
          </figure>

          <div class="card-body">
            <h3 class="card-title text-white">{{ recipe.title }}</h3>
            
            <div class="space-y-2 text-white/80 text-sm">
              <p>🥘 <strong>רכיבים:</strong> {{ recipe.ingredients | slice:0:50 }}...</p>
              <p>📝 <strong>הוראות:</strong> {{ recipe.instructions | slice:0:50 }}...</p>
              <p>🏷️ <strong>תגיות:</strong> {{ recipe.tags }}</p>
              <p>⏱️ <strong>זמן:</strong> {{ recipe.preparationTime }} דקות</p>
            </div>

            <div class="card-actions justify-between mt-4">
              <button 
                (click)="editRecipe(recipe)"
                class="btn btn-primary btn-sm"
              >
                ✏️ ערוך
              </button>
              <button 
                (click)="deleteRecipe(recipe.id)"
                class="btn btn-error btn-sm"
              >
                🗑️ מחק
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoadingRecipes && filteredRecipes.length === 0" class="text-center py-16">
        <p class="text-white/60 text-lg">{{ searchTerm ? 'לא נמצאו מתכונים 😞' : 'אין מתכונים עדיין. בואו נהתחיל! 🎉' }}</p>
      </div>
    </div>
  </div>
</div>
